(window.webpackJsonp=window.webpackJsonp||[]).push([["main"],{"+KfG":function(t,e,n){"use strict";n.r(e);var i=n("Vro6"),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("main",[n("button",{staticClass:"btn-reset",on:{click:t.reset}},[t._v("reset")]),t._v(" "),t.items.length?n("InfiniteScroll",{attrs:{direction:"up",auto:"in-viewport",head:t.items[0]&&t.items[0].id,next:t.prev,handler:t.loadPrevPage}}):t._e(),t._v(" "),n("ul",t._l(t.items,(function(e){return n("li",{key:e.id,style:{background:"hsl("+e.color.join()+")"},attrs:{"data-inf-id":e.id}},[t._v("\n      "+t._s(e.id)+"\n    ")])})),0),t._v(" "),n("InfiniteScroll",{attrs:{head:t.items.length,next:t.next,handler:t.loadNextPage}})],1)};o._withStripped=!0;var r=n("iiaA"),s=n.n(r),a=n("dmp9"),c=n.n(a),l=function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{staticClass:"infinite-scroll",on:{click:t.onClick}},[t._t("default",["loading"===t.state?[t._v("\n      Loading...\n    ")]:"empty"===t.state?[t._v("\n      Empty\n    ")]:"end"===t.state?[t._v("\n      End\n    ")]:"error"===t.state?[t._v("\n      An error occurred. Click to retry.\n    ")]:"standby"===t.state&&"in-advance"!==t.auto?[t._v("\n      "+t._s(t.auto?"Scroll "+t.direction+" to load more":"Click to load more")+"\n    ")]:t._e()],{state:t.state,error:t.error,auto:t.auto,direction:t.direction})],2)};l._withStripped=!0;var u={name:"InfiniteScroll",props:{handler:Function,head:{},next:{},direction:{type:String,default:"down"},auto:{default:"in-advance"}},data:function(){return{state:"standby",error:{}}},watch:{auto:function(t){t?(this.addListeners(),this.check()):this.removeListeners()},next:function(){this.setState(),"up"!==this.direction||!this.head||this.scrollContainer===window&&"overflowAnchor"in document.body.style&&0!==this.getScrollY()||this.restorePosition(),"in-advance"===this.auto&&this.check()}},created:function(){this.setState()},mounted:function(){if(this.scrollContainer=this.getScrollContainer(this.$el),this.auto)if(this.addListeners(),"in-advance"===this.auto)this.check();else if("up"===this.direction&&this.inViewport()){var t,e=this.$el.getBoundingClientRect().top;t=this.scrollContainer===window?e+1:e-this.scrollContainer.getBoundingClientRect().top+1,this.scrollContainer.scrollBy(0,t)}},destroyed:function(){this.removeListeners()},methods:{getScrollContainer:function(t){var e=t.parentNode;return e===document.body?window:["scroll","auto"].includes(window.getComputedStyle(e).overflowY)?e:this.getScrollContainer(e)},setState:function(){this.state=null===this.next?this.head?"end":"empty":"standby"},onClick:function(){"standby"!==this.state&&"error"!==this.state||this.load()},load:function(){var t=this;return c()(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.state="loading",t.error=null,"up"===t.direction&&t.savePosition(),e.prev=3,e.next=6,t.handler();case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(3),t.state="error",t.error=e.t0;case 12:case"end":return e.stop()}}),e,null,[[3,8]])})))()},savePosition:function(){this.lastHead=this.head,this.spacing=this.head?document.querySelector('[data-inf-id="'+this.head+'"]').getBoundingClientRect().top-this.$el.getBoundingClientRect().bottom:0},restorePosition:function(){console.log("restorePosition");var t=this.lastHead?this.getScrollY()+document.querySelector('[data-inf-id="'+this.lastHead+'"]').getBoundingClientRect().top-this.$el.getBoundingClientRect().bottom-this.spacing:this.getScrollHeight()-this.getClientHeight();this.scrollContainer.scrollTo(0,t)},getClientHeight:function(){return this.scrollContainer===window?window.innerHeight:this.scrollContainer.clientHeight},getScrollHeight:function(){return this.scrollContainer===window?document.documentElement.scrollHeight:this.scrollContainer.scrollHeight},getScrollY:function(){return this.scrollContainer===window?window.scrollY:this.scrollContainer.scrollTop},check:function(){var t=this;"standby"!==this.state||this.timer||(this.timer=setTimeout((function(){t.timer=null,("in-advance"===t.auto&&t.isNear()||"in-viewport"===t.auto&&t.inViewport())&&t.load()})))},isNear:function(){var t=this.getScrollY(),e=this.getScrollHeight();return"down"===this.direction&&e-t<2*window.screen.height||"up"===this.direction&&t<window.screen.height},inViewport:function(){var t=this.$el.getBoundingClientRect();if(this.scrollContainer===window){if(t.top>=0&&t.bottom<=window.innerHeight)return!0}else{var e=this.scrollContainer.getBoundingClientRect();if(t.top>=e.top&&t.bottom<=e.bottom)return!0}return!1},addListeners:function(){this.scrollContainer.addEventListener("scroll",this.check),window.addEventListener("resize",this.check)},removeListeners:function(){this.scrollContainer.removeEventListener("scroll",this.check),window.removeEventListener("resize",this.check)}}},d=(n("6Hep"),n("OAcY")),h=Object(d.a)(u,l,[],!1,null,"2964abc9",null);h.options.__file="src/index.vue";var p=h.exports,v={components:{InfiniteScroll:p},data:function(){return{items:[],prev:4,next:5}},methods:{loadNextPage:function(){var t=this;return c()(s.a.mark((function e(){var n,i,o,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(Date.now(),"loadNextPage"),n=t.next,e.next=4,t.getMockData({limit:10,page:n});case 4:i=e.sent,o=i.items,r=i.totalCount,n===t.next&&(t.items=t.items.concat(o),t.next=r/10>n?n+1:null,console.log("next:",t.next));case 8:case"end":return e.stop()}}),e)})))()},loadPrevPage:function(){var t=this;return c()(s.a.mark((function e(){var n,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(Date.now(),"loadPrevPage"),n=t.prev,e.next=4,t.getMockData({limit:10,page:n});case 4:i=e.sent,o=i.items,n===t.prev&&(t.items=o.concat(t.items),t.prev=n-1||null,console.log("prev:",t.prev));case 7:case"end":return e.stop()}}),e)})))()},getMockData:function(t){return c()(s.a.mark((function e(){var n,i,o,r,a,c,l,u,d,h;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(n=void 0===t?{}:t).limit,o=void 0===i?10:i,r=n.page,a=void 0===r?1:r,console.log("page:",a),e.next=4,new Promise((function(t){return setTimeout(t,2e3*Math.random())}));case 4:for(100,c=(a-1)*o,l=Math.min(c+o,100),u=[],d=c;d<l;d++)h=[360/99*d,"67%","67%"],u.push({id:d+1,color:h});return e.abrupt("return",{items:u,totalCount:100});case 10:case"end":return e.stop()}}),e)})))()},reset:function(){this.items=[],this.prev=4,this.next=5}}},f=(n("pQzR"),Object(d.a)(v,o,[],!1,null,"3783d5fa",null));f.options.__file="demo-src/App.vue";var g=f.exports;new i.a(g).$mount("#app")},"6Hep":function(t,e,n){"use strict";var i=n("B//W");n.n(i).a},"B//W":function(t,e,n){},Jk1k:function(t,e,n){},pQzR:function(t,e,n){"use strict";var i=n("Jk1k");n.n(i).a}},[["+KfG","runtime","vendors~main"]]]);
//# sourceMappingURL=ba35230a2fc92d9ee9e7.js.map